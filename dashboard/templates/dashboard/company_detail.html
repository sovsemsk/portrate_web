{% extends "dashboard/base.html" %}
{% load static %}
{% load tz %}
{% load extensions %}
{% block content %}
{% include "dashboard/_company_head.html" %}
{% include "dashboard/_company_tabs.html" %}
<div class="bp5-form-group">
    <form novalidate>
        <div style="align-items:center;display:flex;gap:5px;">
            {{filter.form.created_at}}
            <button class="bp5-button bp5-intent-warning" type="submit">Найти</button>
        </div>
    </form>
</div>
<div class="bp5-form-group">
    <div class="bp5-card bp5-elevation-1 bp5-section">
        <div class="bp5-section-header">
            <div class="bp5-section-header-left">
                <div>
                    <h6 class="bp5-heading bp5-section-header-title">Яндекс</h6>
                    <div class="bp5-section-header-sub-title bp5-text-muted">отзывы и рейтинг</div>
                </div>
            </div>
            <div class="bp5-section-header-left">
                <img alt="Яндекс" class="bp5-icon" height=16 src="{% static 'images/services/yandex.svg' %}" width=16>
            </div>
        </div>
        <div class="bp5-padded bp5-section-card">
            <div style="display:flex;gap:5px">
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3)" >
                    <div class="bp5-form-group">
                        <h2 class="bp5-heading">
                            {{company.rating_yandex|default:"0,0"}}
                        </h2>
                    </div>
                    <span class="bp5-text-large">Рейтинг</span>
                    <div class="bp5-text-muted">
                        {% timezone user.profile.default_timezone %}
                        {{company.rating_yandex_last_parse_at|default:"Нет данных"}}
                        {% endtimezone %}
                    </div>
                </div>
                <!-- Исключение для css (высота) -->
                <div class="bp5-callout bp5-elevation-1" style="flex:2 calc(100% / 1.5 + 5px);height:130px;">
                    <canvas height=100 id="RATING_YANDEX_CHART" width=475></canvas>
                </div>
            </div>
        </div>
        <div class="bp5-padded bp5-section-card">
            <div style="display:flex;gap:5px">
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{reviews_yandex_total_count|default:"0"}}
                        </h3>
                    </div>
                    {{company.reviews_yandex_positive_count|rupluralize:"Отзыв, Отзыва, Отзывов"}}
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{company.reviews_yandex_last_parse_at|default:"Нет данных"}}
                        {% endtimezone %}
                    </div>
                </div>
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{reviews_yandex_positive_count|default:"0"}}
                        </h3>
                    </div>
                    {{company.reviews_yandex_positive_count|rupluralize:"Позитивный отзыв, Позитивных отзыва, Позитивных отзывов"}}
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{company.reviews_yandex_last_parse_at|default:"Нет данных"}}
                        {% endtimezone %}
                    </div>
                </div>
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{reviews_yandex_negative_count|default:"0"}}
                        </h3>
                    </div>
                    {{company.reviews_yandex_negative_count|rupluralize:"Негативный отзыв, Негативных отзыва, Негативных отзывов"}}
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{company.reviews_yandex_last_parse_at|default:"Нет данных"}}
                        {% endtimezone %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="bp5-form-group">
    <div class="bp5-card bp5-elevation-1 bp5-section">
        <div class="bp5-section-header">
            <div class="bp5-section-header-left">
                <div>
                    <h6 class="bp5-heading bp5-section-header-title">2Гис</h6>
                    <div class="bp5-section-header-sub-title bp5-text-muted">отзывы и рейтинг</div>
                </div>
            </div>
            <div class="bp5-section-header-left">
                <img alt="2Гис" class="bp5-icon" height=16 src="{% static 'images/services/gis.svg' %}" width=16>
            </div>
        </div>
        <div class="bp5-padded bp5-section-card">
            <div style="display:flex;gap:5px">
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h2 class="bp5-heading">
                            {{company.rating_gis|default:"0,0"}}
                        </h2>
                    </div>
                    <span class="bp5-text-large">Рейтинг</span>
                    <div class="bp5-text-muted">
                        {% timezone user.profile.default_timezone %}
                        {{company.rating_gis_last_parse_at|default:"Нет данных"}}
                        {% endtimezone %}
                    </div>
                </div>
                <!-- Исключение для css (высота) -->
                <div class="bp5-callout bp5-elevation-1" style="flex:2 calc(100% / 1.5 + 5px);height:130px;">
                    <canvas height=100 id="RATING_GIS_CHART" width=475></canvas>
                </div>
            </div>
        </div>
        <div class="bp5-padded bp5-section-card">
            <div style="display:flex;gap:5px">
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3)">
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{reviews_gis_total_count|default:"0"}}
                        </h3>
                    </div>
                    {{company.reviews_gis_total_count|rupluralize:"Отзыв, Отзыва, Отзывов"}}
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{company.reviews_gis_last_parse_at|default:"Нет данных"}}
                        {% endtimezone %}
                    </div>
                </div>
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3)" >
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{reviews_gis_positive_count|default:"0"}}
                        </h3>
                    </div>
                    {{company.reviews_gis_positive_count|rupluralize:"Позитивный отзыв, Позитивных отзыва, Позитивных отзывов"}}
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{company.reviews_gis_last_parse_at|default:"Нет данных"}}
                        {% endtimezone %}
                    </div>
                </div>
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3)" >
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{reviews_gis_negative_count|default:"0"}}
                        </h3>
                    </div>
                    {{company.reviews_gis_negative_count|rupluralize:"Негативный отзыв, Негативных отзыва, Негативных отзывов"}}
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{company.reviews_gis_last_parse_at|default:"Нет данных"}}
                        {% endtimezone %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="bp5-form-group">
    <div class="bp5-card bp5-elevation-1 bp5-section">
        <div class="bp5-section-header">
            <div class="bp5-section-header-left">
                <div>
                    <h6 class="bp5-heading bp5-section-header-title">Google</h6>
                    <div class="bp5-section-header-sub-title bp5-text-muted">отзывы и рейтинг</div>
                </div>
            </div>
            <div class="bp5-section-header-left">
                <img alt="Google" class="bp5-icon" height=16 src="{% static 'images/services/google.svg' %}" width=16>
            </div>
        </div>
        <div class="bp5-padded bp5-section-card">
            <div style="display:flex;gap:5px">
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h2 class="bp5-heading">
                            {{company.rating_google|default:"0,0"}}
                        </h2>
                    </div>
                    <span class="bp5-text-large">Рейтинг</span>
                    <div class="bp5-text-muted">
                        {% timezone user.profile.default_timezone %}
                        {{company.rating_google_last_parse_at|default:"Нет данных"}}
                        {% endtimezone %}
                    </div>
                </div>
                <!-- Исключение для css (высота) -->
                <div class="bp5-callout bp5-elevation-1" style="flex:2 calc(100% / 1.5 + 5px);height:130px;">
                    <canvas height=100 id="RATING_GOOGLE_CHART" width=475></canvas>
                </div>
            </div>
        </div>
        <div class="bp5-padded bp5-section-card">
            <div style="display:flex;gap:5px">
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{reviews_google_total_count|default:"0"}}
                        </h3>
                    </div>
                    {{company.reviews_google_total_count|rupluralize:"Отзыв, Отзыва, Отзывов"}}
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{company.reviews_google_last_parse_at|default:"Нет данных"}}
                        {% endtimezone %}
                    </div>
                </div>
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{reviews_google_positive_count|default:"0"}}
                        </h3>
                    </div>
                    {{company.reviews_google_positive_count|rupluralize:"Позитивный отзыв, Позитивных отзыва, Позитивных отзывов"}}
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{company.reviews_google_last_parse_at|default:"Нет данных"}}
                        {% endtimezone %}
                    </div>
                </div>
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{reviews_google_negative_count|default:"0"}}
                        </h3>
                    </div>
                    {{company.reviews_google_negative_count|rupluralize:"Негативный отзыв, Негативных отзыва, Негативных отзывов"}}
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{company.reviews_google_last_parse_at|default:"Нет данных"}}
                        {% endtimezone %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block script %}
<script type="text/javascript">
    const options = {
        layout: {
            padding: {bottom: -3}
        },
        animation: false,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            x: {
                ticks: {
                    color: "#5f6b7c",
                    font: {
                        family: "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif",
                        size: 10
                    }
                },
                grid: {
                    display: false
                }
            },
            y: {
                min: 0,
                max: 5,
                ticks: {
                    color: "#5f6b7c",
                    font: {
                        family: "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif",
                        size: 10
                    }
                },

                grid: {
                    display: false
                }
            }
        }
    }

    $.get("{% url 'company_rating_yandex_dynamic' company.id %}?{{request.META.QUERY_STRING|safe}}", (data) => {
        var ctx = $("#RATING_YANDEX_CHART").get(0).getContext("2d");
        new Chart(ctx, {
            type: "line",
            data: data,
            options: options
        });
    });
    $.get("{% url 'company_rating_gis_dynamic' company.id %}?{{request.META.QUERY_STRING|safe}}", (data) => {
        var ctx = $("#RATING_GIS_CHART").get(0).getContext("2d");
        new Chart(ctx, {
            type: "line",
            data: data,
            options: options
        });
    });
    $.get("{% url 'company_rating_google_dynamic' company.id %}?{{request.META.QUERY_STRING|safe}}", (data) => {
        var ctx = $("#RATING_GOOGLE_CHART").get(0).getContext("2d");
        new Chart(ctx, {
            type: "line",
            data: data,
            options: options
        });
    });
</script>
{% endblock %}