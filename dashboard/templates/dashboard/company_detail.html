{% extends 'dashboard/base.html' %}
{% load static %}
{% load tz %}
{% block content %}
{% include 'dashboard/_company_head.html' %}
{% include 'dashboard/_company_tabs.html' %}
<div class="bp5-form-group">
    <div style="display:flex;gap:5px;">
        <a class="bp5-button bp5-intent-warning" href="{% url 'company_update' company.id %}">Настройки</a>
        <a class="bp5-button bp5-intent-warning" href="{{company.host}}/@{{company.id}}" target="_blank">Форма запроса отзыва</a>
    </div>
</div>
<div class="bp5-form-group">
    <div class="bp5-card bp5-elevation-1 bp5-section">
        <div class="bp5-section-header">
            <div class="bp5-section-header-left">
                <div>
                    <h6 class="bp5-heading bp5-section-header-title">Яндекс</h6>
                    <div class="bp5-section-header-sub-title bp5-text-muted">рейтинг и отзывы</div>
                </div>
            </div>
            <div class="bp5-section-header-left">
                <img class="bp5-icon" style="width:16px" src="{% static 'images/services/yandex.svg' %}" >
            </div>
        </div>
        <div class="bp5-padded bp5-section-card">
            <div style="display:flex;gap:5px">
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3)" >
                        <div class="bp5-form-group">
                            <h2 class="bp5-heading">
                                {{ company.rating_yandex|default:'0,0' }}
                            </h2>
                        </div>
                        Рейтинг
                        <div class="bp5-text-muted bp5-text-small">
                            {% timezone user.profile.default_timezone %}
                            {{ company.rating_yandex_last_parse_at|default:'Нет данных' }}
                            {% endtimezone %}
                        </div>
                </div>
                <div class="bp5-callout bp5-elevation-1" style="flex:2 calc(100% / 1.5 + 5px);padding-bottom:0;min-height:125px;">
                    <canvas id="RATING_YANDEX_CHART" width="475" height="100" ></canvas>
                </div>
            </div>
        </div>
        <div class="bp5-padded bp5-section-card">
            <div style="display:flex;gap:5px">
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{ company.reviews_yandex_positive_count|default:'0' }}
                        </h3>
                    </div>
                    Позитивных отзывов
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{ company.reviews_yandex_last_parse_at|default:'Нет данных' }}
                        {% endtimezone %}
                    </div>
                </div>
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{ company.reviews_yandex_negative_count|default:'0' }}
                        </h3>
                    </div>
                    Негативных отзывов
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{ company.reviews_yandex_last_parse_at|default:'Нет данных' }}
                        {% endtimezone %}
                    </div>
                </div>
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{ company.reviews_google_total_count|default:'0' }}
                        </h3>
                    </div>
                    Всего отзывов
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{ company.reviews_yandex_last_parse_at|default:'Нет данных' }}
                        {% endtimezone %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="bp5-form-group">
    <div class="bp5-card bp5-elevation-1 bp5-section">
        <div class="bp5-section-header">
            <div class="bp5-section-header-left">
                <div>
                    <h6 class="bp5-heading bp5-section-header-title">2Гис</h6>
                    <div class="bp5-section-header-sub-title bp5-text-muted">рейтинг и динамика</div>
                </div>
            </div>
            <div class="bp5-section-header-left">
                <img class="bp5-icon" style="width:16px" src="{% static 'images/services/gis.svg' %}" >
            </div>
        </div>
        <div class="bp5-padded bp5-section-card">
            <div style="display:flex;gap:5px">
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h2 class="bp5-heading">
                            {{ company.rating_gis|default:'0,0' }}
                        </h2>
                    </div>
                    Обновлено
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{ company.rating_gis_last_parse_at|default:'Нет данных' }}
                        {% endtimezone %}
                    </div>
                </div>
                <div class="bp5-callout bp5-elevation-1" style="flex:2 calc(100% / 1.5 + 5px);padding-bottom:0;min-height:125px;">
                    <canvas id="RATING_GIS_CHART" width="475" height="100" ></canvas>
                </div>
            </div>
        </div>
        <div class="bp5-padded bp5-section-card">
            <div style="display:flex;gap:5px">
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3)" >
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{ company.reviews_gis_positive_count|default:'0' }}
                        </h3>
                    </div>
                    Позитивных отзывов
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{ company.reviews_gis_last_parse_at|default:'Нет данных' }}
                        {% endtimezone %}
                    </div>
                </div>
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3)" >
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{ company.reviews_gis_negative_count|default:'0' }}
                        </h3>
                    </div>
                    Негативных отзывов
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{ company.reviews_gis_last_parse_at|default:'Нет данных' }}
                        {% endtimezone %}
                    </div>
                </div>
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3)" >
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{ company.reviews_gis_total_count|default:'0' }}
                        </h3>
                    </div>
                    Всего отзывов
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{ company.reviews_gis_last_parse_at|default:'Нет данных' }}
                        {% endtimezone %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="bp5-form-group">
    <div class="bp5-card bp5-elevation-1 bp5-section">
        <div class="bp5-section-header">
            <div class="bp5-section-header-left">
                <div>
                    <h6 class="bp5-heading bp5-section-header-title">Google</h6>
                    <div class="bp5-section-header-sub-title bp5-text-muted">рейтинг и динамика</div>
                </div>
            </div>
            <div class="bp5-section-header-left">
                <img class="bp5-icon" style="width:16px" src="{% static 'images/services/google.svg' %}" >
            </div>
        </div>
        <div class="bp5-padded bp5-section-card">
            <div style="display:flex;gap:5px">
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h2 class="bp5-heading">
                            {{ company.rating_google|default:'0,0' }}
                        </h2>
                    </div>
                    Обновлено
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{ company.rating_google_last_parse_at|default:'Нет данных' }}
                        {% endtimezone %}
                    </div>
                </div>
                <div class="bp5-callout bp5-elevation-1" style="flex:2 calc(100% / 1.5 + 5px);padding-bottom:0;min-height:125px;">
                    <canvas id="RATING_GOOGLE_CHART" width="475" height="100" ></canvas>
                </div>
            </div>
        </div>
        <div class="bp5-padded bp5-section-card">
            <div style="display:flex;gap:5px">
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{ company.reviews_google_positive_count|default:'0' }}
                        </h3>
                    </div>
                    Позитивных отзывов
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{ company.reviews_google_last_parse_at|default:'Нет данных' }}
                        {% endtimezone %}
                    </div>
                </div>
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{ company.reviews_google_negative_count|default:'0' }}
                        </h3>
                    </div>
                    Негативных отзывов
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{ company.reviews_google_last_parse_at|default:'Нет данных' }}
                        {% endtimezone %}
                    </div>
                </div>
                <div class="bp5-callout bp5-elevation-1" style="flex:1 calc(100% / 3);">
                    <div class="bp5-form-group">
                        <h3 class="bp5-heading">
                            {{ company.reviews_google_total_count|default:'0' }}
                        </h3>
                    </div>
                    Всего отзывов
                    <div class="bp5-text-muted bp5-text-small">
                        {% timezone user.profile.default_timezone %}
                        {{ company.reviews_google_last_parse_at|default:'Нет данных' }}
                        {% endtimezone %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--
<div class="bp5-section bp5-card bp5-elevation-1">
    <div class="bp5-section-header">
        <div class="bp5-section-header-left">
            <div>
                <h6 class="bp5-heading bp5-section-header-title">Отзывы</h6>
                <div class="bp5-section-header-sub-title bp5-text-muted">количество отзывов поисковых системах и классифаерах</div>
            </div>
        </div>
    </div>
    <div class="bp5-section-card">
        <table class="bp5-html-table bp5-html-table-bordered bp5-html-table-striped" style="width:100%;">
            <thead>
                <tr>
                    <th></th>
                    <th>Время обновления</th>
                    <th>Позитив</th>
                    <th>Негатив</th>
                    <th>Всего</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <img class="bp5-icon" style="height:16px;margin-left:10px;margin-right:5px 16px;" src="{% static 'images/services/yandex.svg' %}">Яндекс
                    </td>
                    <td>
                        <span class="bp5-text-muted bp5-text-small">
                            {% timezone user.profile.default_timezone %}
                            {{ company.reviews_yandex_last_parse_at|default:'Нет данных' }}
                            {% endtimezone %}
                        </span>
                    </td>
                    <td>{{ company.reviews_yandex_positive_count|default:'0' }}</td>
                    <td>{{ company.reviews_yandex_negative_count|default:'0' }}</td>
                    <td>{{ company.reviews_yandex_total_count|default:'0' }}</td>
                </tr>
                <tr>
                    <td>
                        <img class="bp5-icon" style="height:16px;margin-left:10px;margin-right:5px 16px;" src="{% static 'images/services/gis.svg' %}">2Гис
                    </td>
                    <td>
                        <span class="bp5-text-muted bp5-text-small">
                            {% timezone user.profile.default_timezone %}
                            {{ company.reviews_gis_last_parse_at|default:'Нет данных' }}
                            {% endtimezone %}
                        </span>
                    </td>
                    <td>{{ company.reviews_gis_positive_count|default:'0' }}</td>
                    <td>{{ company.reviews_gis_negative_count|default:'0' }}</td>
                    <td>{{ company.reviews_gis_total_count|default:'0' }}</td>
                </tr>
                <tr>
                    <td>
                        <img class="bp5-icon" style="height:16px;margin-left:10px;margin-right:5px 16px;" src="{% static 'images/services/google.svg' %}">Google
                    </td>
                    <td>
                        <span class="bp5-text-muted bp5-text-small">
                            {% timezone user.profile.default_timezone %}
                            {{ company.reviews_google_last_parse_at|default:'Нет данных' }}
                            {% endtimezone %}
                        </span>
                    </td>
                    <td>{{ company.reviews_google_positive_count|default:'0' }}</td>
                    <td>{{ company.reviews_google_negative_count|default:'0' }}</td>
                    <td>{{ company.reviews_google_total_count|default:'0' }}</td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan=4></td>
                    <td>{{ company.reviews_total_count|default:'0' }}</td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>
-->
{% endblock %}
{% block script %}
<script type="text/javascript">
    const options = {
    animation: false,
        plugins: {
            legend: {
                display: false
            }
        },

        scales: {
            x: {

                grid: {
                    display: false
                }
            },
            y: {
                display: false,
                grid: {
                    display: false
                }
            }
        }
    }

    $.get('{% url "company_rating_yandex_dynamic" company.id %}', function(data) {
        var ctx = $("#RATING_YANDEX_CHART").get(0).getContext("2d");
        new Chart(ctx, {
            type: 'line',
            data: data,
            options: options
        });
    });
    $.get('{% url "company_rating_gis_dynamic" company.id %}', function(data) {
        var ctx = $("#RATING_GIS_CHART").get(0).getContext("2d");
        new Chart(ctx, {
            type: 'line',
            data: data,
            options: options
        });
    });
    $.get('{% url "company_rating_google_dynamic" company.id %}', function(data) {
        var ctx = $("#RATING_GOOGLE_CHART").get(0).getContext("2d");
        new Chart(ctx, {
            type: 'line',
            data: data,
            options: options
        });
    });
</script>
{% endblock %}