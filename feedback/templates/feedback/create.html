{% extends 'feedback/base.html' %}
{% load static %}

{% block content %}
<div class="bp5-padded bp5-section-card">
    <h1 style="margin:0 0 15px 0;text-align:center;">
        {{ company.request_form_negative_head }}
    </h1>
    <p class="bp5-text-muted" style="font-size:12px;margin:0 0 15px 0;text-align:center;">
        {{ company.request_form_negative_text }}
    </p>
</div>
<div class="bp5-padded bp5-section-card">
    <form action="" id="request-form" method="post" novalidate>
        {% csrf_token %}
        <div class="bp5-form-group tag_widget">
            <label class="bp5-label">Что именно вам не понравилось?</label>
            <div style="display:flex;flex-wrap:wrap;gap:5px">
                {% for tag in company.request_form_tags %}
                <label class="bp5-interactive bp5-minimal bp5-intent-success bp5-tag">
                    <input name="tag" type="checkbox" value="{{ tag }}" style="display:none"/>
                    {{ tag }}
                </label>
                {% endfor %}
            </div>
        </div>
        <div class="bp5-form-group">
            {{ form.text }}
        </div>
        <div class="bp5-form-group">
            <!-- Контактный телефон -->
            <label class="bp5-label">Оставьте ваш контакт</label>
            {{ form.phone }}
            {% if form.phone.errors %}
            <div class="bp5-form-helper-text" style="color:#ac2f33">Необходимо заполнить контактный телефон</div>
            {% endif %}
        </div>
    </form>
</div>
<div class="bp5-padded bp5-section-card">
    <button class="bp5-button bp5-fill bp5-intent-success bp5-large" form="request-form" type="submit">Отправить</button>
</div>

<script>
    const textarea = $('textarea[name=text]');

    $('input[type=checkbox]').each((index, element) => {
        const checkbox = $(element);

        if(textarea.val().includes(checkbox.val())){
            checkbox.checked = true;
            checkbox.parent().addClass('bp5-active');
        }

        checkbox.click((event) => {
            $(event.target).parent().toggleClass('bp5-active')
            textarea.val(
                [...$('input[name=tag]:checked')].map(e => e.value).join(', ')
            );
        });
    });

    IMask(
        document.getElementById('id_phone'),
        {mask: '+7 000 000-00-00'}
    );
</script>
{% endblock %}
